@model Gestion_Del_Presupuesto.Models.ConvenioModel

<div class="container">
    <h2 class="text-center mb-4">Editar Convenio</h2>
    <form asp-action="Edit" method="post">
        <!-- Datos del Convenio -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <input type="hidden" asp-for="Id_Convenio" /> <!-- Campo oculto para el Id del convenio -->

                <div class="form-group mb-4">
                    <label asp-for="Sede"></label>
                    <select asp-for="Sede" class="form-control">
                        <option value="">Selecciona una Sede</option>
                        @foreach (var sede in ViewBag.Sedes)
                        {
                            <option value="@sede" selected="@(Model.Sede == sede ? "selected" : null)">@sede</option>
                        }
                    </select>
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Tipo_Convenio"></label>
                    <select asp-for="Tipo_Convenio" class="form-control">
                        <option value="">Selecciona un Tipo</option>
                        <option value="HOSPITALES / CLINICAS" selected="@(Model.Tipo_Convenio == "HOSPITALES / CLINICAS" ? "selected" : null)">HOSPITALES / CLINICAS</option>
                        <option value="ATENCION PRIMARIA" selected="@(Model.Tipo_Convenio == "ATENCION PRIMARIA" ? "selected" : null)">ATENCION PRIMARIA</option>
                        <option value="Hogares / C.Educacionales" selected="@(Model.Tipo_Convenio == "Hogares / C.Educacionales" ? "selected" : null)">Hogares / C.Educacionales</option>
                        <option value="LAB/IMAGEN/OFTA" selected="@(Model.Tipo_Convenio == "LAB/IMAGEN/OFTA" ? "selected" : null)">LAB IMAGEN OFTA</option>
                        <option value="CENTROS Y FUNDACIONES" selected="@(Model.Tipo_Convenio == "CENTROS Y FUNDACIONES" ? "selected" : null)">CENTROS Y FUNDACIONES</option>
                        <option value="CASINOS" selected="@(Model.Tipo_Convenio == "CASINOS" ? "selected" : null)">CASINOS</option>
                    </select>
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Nombre"></label>
                    <input asp-for="Nombre" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Rut"></label>
                    <input asp-for="Rut" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Direccion"></label>
                    <input asp-for="Direccion" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="ContactoPrincipal"></label>
                    <input asp-for="ContactoPrincipal" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Telefono"></label>
                    <input asp-for="Telefono" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Fecha_Inicio"></label>
                    <input asp-for="Fecha_Inicio" type="date" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <label asp-for="Fecha_Termino"></label>
                    <input asp-for="Fecha_Termino" type="date" class="form-control" />
                </div>
                <div class="form-group mb-4">
                    <input type="checkbox" asp-for="RenovacionAutomatica" id="RenovacionAutomatica" />
                    <label for="RenovacionAutomatica">Renovable automáticamente por períodos iguales o sucesivos de un año</label>
                </div>
            </div>
        </div>

        <!-- Retribuciones -->
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h4 class="mb-3 text-center">Retribuciones</h4>
                <div class="card mb-3">
                    <div class="card-body">
                        <div id="retribucionesContainer">
                            @for (int i = 0; i < Model.Retribuciones.Count; i++)
                            {
                                <div class="form-group retribucion-item">
                                    <div class="row align-items-center">
                                        <div class="col-md-2">
                                            <label>Tipo de Retribución</label>
                                            <select asp-for="Retribuciones[@i].Tipo_Retribucion" class="form-control">
                                                <option value="">Selecciona un Tipo</option>
                                                @foreach (var tipo in ViewBag.TiposRetribucion)
                                                {
                                                    <option value="@tipo" selected="@(Model.Retribuciones[i].Tipo_Retribucion == tipo ? "selected" : null)">@tipo</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label asp-for="Retribuciones[@i].UFTotal">Cantidad UF</label>
                                            <input asp-for="Retribuciones[@i].UFTotal" class="form-control" />
                                        </div>
                                        <div class="col-md-2">
                                            <label asp-for="Retribuciones[@i].CantPesos">Cantidad Pesos</label>
                                            <input asp-for="Retribuciones[@i].CantPesos" class="form-control" />
                                        </div>
                                        <div class="col-md-2">
                                            <label>Periodo</label>
                                            <select asp-for="Retribuciones[@i].Periodo" class="form-control">
                                                <option value="Hora" selected="@(Model.Retribuciones[i].Periodo == "Hora" ? "selected" : null)">Hora</option>
                                                <option value="Diario" selected="@(Model.Retribuciones[i].Periodo == "Diario" ? "selected" : null)">Diario</option>
                                                <option value="Semanal" selected="@(Model.Retribuciones[i].Periodo == "Semanal" ? "selected" : null)">Semanal</option>
                                                <option value="Mensual" selected="@(Model.Retribuciones[i].Periodo == "Mensual" ? "selected" : null)">Mensual</option>
                                                <option value="Anual" selected="@(Model.Retribuciones[i].Periodo == "Anual" ? "selected" : null)">Anual</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label asp-for="Retribuciones[@i].DetalleOtrosGastos">Detalle Otros Gastos</label>
                                            <input asp-for="Retribuciones[@i].DetalleOtrosGastos" class="form-control" />
                                        </div>
                                        <div class="col-md-2 d-flex align-items-end">
                                            <button type="button" class="btn btn-danger btn-sm" onclick="eliminarElemento(this)">Eliminar</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <button type="button" class="btn btn-primary btn-sm mt-3" onclick="agregarElemento()">Agregar Retribución</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Centros de Salud Asociados -->
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h4 class="mb-3 text-center">Centros de Salud Asociados</h4>
                <div class="card mb-3">
                    <div class="card-body">
                        <div id="centrosSaludContainer">
                            @for (int i = 0; i < Model.CentrosDeSalud.Count; i++)
                            {
                                <div class="form-group centro-item mt-3">
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <input asp-for="CentrosDeSalud[@i].NombreCentro" placeholder="Nombre del Centro de Salud" class="form-control mb-2" />
                                        </div>
                                        <div class="col-md-3">
                                            <input asp-for="CentrosDeSalud[@i].Direccion" placeholder="Dirección del Centro de Salud" class="form-control mb-2" />
                                        </div>
                                        <div class="col-md-3">
                                            <input asp-for="CentrosDeSalud[@i].Contacto" placeholder="Contacto del Centro de Salud" class="form-control mb-2" />
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-danger btn-sm" onclick="eliminarElemento(this)">Eliminar</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <button type="button" class="btn btn-secondary mt-3" onclick="agregarCentroSalud()">Agregar Centro</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botón para Guardar -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Guardar Cambios</button>
        </div>
    </form>
</div>

<script>
    // Funciones para agregar y eliminar elementos dinámicos
    let contadorRetribuciones = 1;
    function agregarElemento() {
        const container = document.getElementById('retribucionesContainer');
        const index = container.children.length; // Obtiene el índice correcto
        const newItem = document.createElement('div');
        newItem.className = 'form-group retribucion-item mt-3';
        newItem.innerHTML = `
                <div class="row align-items-center">
                    <div class="col-md-2">
                        <label>Tipo de Retribución</label>
                        <select name="Retribuciones[${index}].Tipo_Retribucion" class="form-control">
                            <option value="">Selecciona un Tipo</option>
                            <option value="Pago por Uso de CC $$">Pago por Uso de CC $$</option>
                            <option value="Pago Apoyo a la Docencia">Pago Apoyo a la Docencia</option>
                            <option value="Pago en RRHH">Pago en RRHH</option>
                            <option value="Capacitación">Capacitación</option>
                            <option value="Obras Menores">Obras Menores</option>
                            <option value="Obras Mayores">Obras Mayores</option>
                            <option value="Otros Gastos x retribución">Otros Gastos x retribución</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Cantidad UF</label>
                        <input type="number" name="Retribuciones[${index}].UFTotal" class="form-control" />
                    </div>
                    <div class="col-md-2">
                        <label>Cantidad Pesos</label>
                        <input type="number" name="Retribuciones[${index}].CantPesos" class="form-control" />
                    </div>
                    <div class="col-md-2">
                        <label>Periodo</label>
                        <select name="Retribuciones[${index}].Periodo" class="form-control">
                            <option value="Hora">Hora</option>
                            <option value="Diario">Diario</option>
                            <option value="Semanal">Semanal</option>
                            <option value="Mensual">Mensual</option>
                            <option value="Anual">Anual</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Detalle Otros Gastos</label>
                        <input type="text" name="Retribuciones[${index}].DetalleOtrosGastos" class="form-control" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-sm" onclick="eliminarElemento(this)">Eliminar</button>
                    </div>
                </div>`;
        container.appendChild(newItem);
    }


    let contadorCentros = 1;
    function agregarCentroSalud() {
        const container = document.getElementById('centrosSaludContainer');
        const newCentro = `
                    <div class="form-group centro-item mt-3">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                        <input name="CentrosDeSalud[${contadorCentros}].NombreCentro" placeholder="Nombre del Centro de Salud" class="form-control mb-2" />
                            </div>
                            <div class="col-md-3">
                                    <input name="CentrosDeSalud[${contadorCentros}].Direccion" placeholder="Dirección del Centro de Salud" class="form-control mb-2" />
                            </div>
                            <div class="col-md-3">
                                    <input name="CentrosDeSalud[${contadorCentros}].Contacto" placeholder="Contacto del Centro de Salud" class="form-control mb-2" />
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-danger btn-sm" onclick="eliminarElemento(this)">Eliminar</button>
                            </div>
                        </div>
                    </div>`;
        container.insertAdjacentHTML('beforeend', newCentro);
        contadorCentros++;
    }

    function eliminarElemento(button) {
        const item = button.closest('.row');
        if (item) item.remove();
    }

</script>
